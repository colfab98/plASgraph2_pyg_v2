Clone project:
git clone https://github.com/colfab98/plASgraph2_pyg_v2

Clone dataset:
cd plASgraph2_pyg_v2
git clone https://github.com/fmfi-compbio/plasgraph2-datasets.git

Manually install Miniconda and set up conda environment:
mkdir -p ~/miniconda3
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh
bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3
rm ~/miniconda3/miniconda.sh
~/miniconda3/bin/conda init bash
exit
cd ~/plASgraph2_pyg_v2

If HPC: 
    conda env create -f environment.yml
    conda activate plasgraph
If Mac:
    conda env create -f environment-mac.yml
    conda activate plasgraph-mac
    pip install torch==2.3.1 torchvision==0.18.1 torchaudio==2.3.1
    pip install torch-scatter torch-sparse torch-cluster torch-spline-conv pyg-lib torch-geometric -f https://data.pyg.org/whl/torch-2.3.1+cpu.html
    pip install -r requirements-mac.txt






export RUN_NAME="name"


Optuna:

python -u -m scripts.tune_hpo \
    --run_name ${RUN_NAME} \
    plasgraph_config.yaml \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/hpo_study/hpo.log 2> runs/${RUN_NAME}/hpo_study/hpo.err

mkdir -p runs/${RUN_NAME}
PYTHONUNBUFFERED=1 accelerate launch --num_processes=1 --mixed_precision=fp16 -m scripts.tune_hpo \
    --run_name ${RUN_NAME} \
    plasgraph_config.yaml \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/hpo_study/hpo.log 2> runs/${RUN_NAME}/hpo_study/hpo.err

optuna-dashboard sqlite:///runs/${RUN_NAME}/hpo_study/hpo_study.db



Audit Data:

mkdir -p runs/${RUN_NAME}/feature_analysis/ && \
python -u -m scripts.audit_cached_data \
    --run_name ${RUN_NAME} \
    plasgraph_config.yaml \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/feature_analysis/audit.log \
    2> runs/${RUN_NAME}/feature_analysis/audit.err



Final Training:

python -u -m scripts.train \
    --run_name ${RUN_NAME} \
    plasgraph_config.yaml \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    --training_mode k-fold \
    > runs/${RUN_NAME}/final_model/train.log 2> runs/${RUN_NAME}/final_model/train.err


mkdir -p runs/${RUN_NAME}
mkdir -p runs/${RUN_NAME}/final_model
PYTHONUNBUFFERED=1 accelerate launch --num_processes=1 --mixed_precision=fp16 -m scripts.train \
    --run_name ${RUN_NAME} \
    plasgraph_config.yaml \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    --training_mode k-fold \
    > runs/${RUN_NAME}/final_model/train.log 2> runs/${RUN_NAME}/final_model/train.err


Analyse Edge Gates:

mkdir -p runs/${RUN_NAME}/gate_analysis
python -u -m scripts.analyze_gates \
    --run_name ${RUN_NAME} \
    plasgraph2-datasets/eskapee-train.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/gate_analysis/analyze_gates.log 2> runs/${RUN_NAME}/gate_analysis/analyze_gates.err



Evaluate:

mkdir -p runs/${RUN_NAME}/evaluation_results
python -u -m scripts.evaluate \
    --run_name ${RUN_NAME} \
    plasgraph2-datasets/eskapee-test.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/evaluation_results/eval.log 2> runs/${RUN_NAME}/evaluation_results/eval.err

mkdir -p runs/${RUN_NAME}/evaluation_results
accelerate launch --num_processes=1 --mixed_precision=fp16 -m scripts.evaluate \
    --run_name ${RUN_NAME} \
    plasgraph2-datasets/eskapee-test.csv \
    plasgraph2-datasets/ \
    > runs/${RUN_NAME}/evaluation_results/eval.log 2> runs/${RUN_NAME}/evaluation_results/eval.err



Explain:

python -m scripts.explain list-contigs \
    output/ESKAPEE_final_model/ \
    eskapee-test/robertson-benchmark_paer-SAMN10163177-s.gfa.gz \
    SAMN10163177 \
    --file_prefix plasgraph2-datasets/


python -m scripts.explain node \
    output/ESKAPEE_final_model/ \
    eskapee-test/robertson-benchmark_paer-SAMN10163177-s.gfa.gz \
    SAMN10163177 \
    'Contig_42_280.615' \
    output/explanation_node/ \
    --file_prefix plasgraph2-datasets/



Classify:

export RUN_NAME="eskapee_v2"   
GFA_PATH="/home/fcolanto/plASgraph2_pyg_v2/plasgraph2-datasets/eskapee-test/robertson-benchmark_abau-SAMN10163228-u.gfa.gz"   
OUT_BASENAME="SAMN10163228_plasgraph.csv" 

mkdir -p "runs/${RUN_NAME}/classify"
python -m scripts.classify \
    --run_name "${RUN_NAME}" \
    gfa "${GFA_PATH}" \
    "${OUT_BASENAME}" \
    > "runs/${RUN_NAME}/classify/${OUT_BASENAME%.csv}.log" \
    2> "runs/${RUN_NAME}/classify/${OUT_BASENAME%.csv}.err"


Visualize predictions:

python -m scripts.visualize_predictions \
    --run_name "eskapee_v1" \
    --prediction_file "runs/eskapee_v1/classify/bacillus_bant-SAMN03024436-u_results.csv" \
    --gfa_file "plasgraph2-datasets/bacillus-test/bacillus_bant-SAMN03024436-u.gfa.gz" \
    --label_file "plasgraph2-datasets/bacillus-test/bacillus_bant-SAMN03024436-u.gfa.csv" \
    > runs/eskapee_v1/visualizations/bacillus_bant-SAMN03024436-u_visual.log \
    2> runs/eskapee_v1/visualizations/bacillus_bant-SAMN03024436-u_visual.err
